.model small

.data

    cadena db 5,0,0,0,0,0,0
    pesos db 8,4,2,1   
    pesoc1 db 7
    suma db 0  
    valorbn db 0
    valorc1 db 0  
    signoc1 db '+'
    
.code 
    
    ;inicializacion del segmento de datos:
    mov ax, seg cadena   
    mov ds, ax
    
    ;leer por teclado:
    mov dx, offset cadena  
    mov ah, 0ah
    int 21h
    
    ;conversion ascii a binario:
    sub cadena [2], 48  
    sub cadena [3], 48
    sub cadena [4], 48
    sub cadena [5], 48
    
    ;cmp cont, 0
    ;je fin
                 
    mov al, cadena[3]
    mul pesos[1]
    mov bl, al 
    
    mov al, cadena[4]
    mul pesos[2]
    add bl, al
    
    mov al, cadena[5]
    mul pesos[3]
    add bl, al 
    
    mov suma, bl    ;guardamos el resultado porque nos sirve para el Complemento a 1.
    
    mov al, cadena[2]
    
    mul pesos[0]  
    add bl, al    
    mov valorbn, bl  ;guardamos el valor en binario natural sin signo
    
    
             
    ;Calculamos el Complemento a 1:
    
          
    cmp cadena[2], 1  ;vemos si es negativo para imprimir el signo
    je negativo
    
    ;si no lo es:
    jmp fin       
    
    negativo:
    mov signoc1, '-'

    ;Obtenemos y guardamos su valor en c1:
    mov al, cadena[2]
    mul pesoc1     ;Si es positivo = 0
    mov bl, al 
    sub bl, suma ;Si es negativo, restamos el valor guardado en suma
    mov valorc1, bl 
    
    mov ax, bx
    mov bl, 10   ;????     
           
    fin:       
    ;en ah se almacena el resto (unidad) y en al el cociente
    div bl
    mov cl, al
    add cl, 48
    mov ch, ah
    add ch, 48
                  
    ;establece modo texto de pantalla para imprimir los digitos en decimal
    mov al, 03h
    mov ah, 00h
    int 10h
    
    ;mover segmento a memoria de Â´video
    mov ax,0b800h
    mov es, ax
    mov di,0
    
    ;Mostrar binario natural
    mov ah, 00001111b   ;fondo negro y texto blanco
    mov al, 'B'
    mov es:[di], ax
    mov al, 'N'
    mov es:[di+2], ax
    mov al, ':'
    mov es:[di+4], ax
    
    mov ah, 0
    mov al, valorbn
    mov bl, 10d
    div bl
    add al, 30h
    mov es:[di+6], al
    add ah, 30h
    mov es:[di+8], ah
    
    ;Mostramos el Complemento a 1:     
    mov al, 'C'
    mov es:[di+12], ax
    mov al, '1'
    mov es:[di+14], ax
    mov al, ':'
    mov es:[di+16], ax
    mov al, signoc1
    mov es:[di+18], ax
    mov al, valorc1
    add al, 30h
    mov es:[di+20], ax
    
    mov ah, 00h
    int 16h
    
    ;fin:
    mov ah, 4ch      ; Esta rutina finalizara el programa y devolvera el control al OS.
    int 21h
end